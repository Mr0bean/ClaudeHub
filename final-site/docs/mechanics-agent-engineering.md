---
title: "代理工程 | Claude Hub"
---

# 代理工程 | Claude Hub

我们经历了 AI 交互的三个不同时代：从提示工程（Prompt Engineering，精心制作完美的单个提示）到上下文工程（Context Engineering，通过 `CLAUDE.md` 文件优化上下文、内容选择和保留）再到现在的代理工程（Agent Engineering，设计专业化、可重用、高效的 AI 代理）。在每个阶段，我们分享成果和作为社区共同成长的能力都在扩展：从分享单个提示，到分享全面的上下文配置和策略，再到现在分享可跨项目工作的完整便携式代理定义。

`自定义代理`代表了 Claude Code 工作流程的最新范式转变，从手动编排到自动委派，从项目特定解决方案到便携式专业工具。本指南涵盖了在深入高级策略之前您需要了解的基本基础。

* * *

* * *

## 理解代理生态系统[​](#理解代理生态系统 "直接链接到理解代理生态系统")

| 方面 | 自定义代理 | 分角色子代理 | 任务/代理工具 |
|------|------------|--------------|---------------|
| **令牌效率** | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐ |
| **激活方式** | 自动委派 | 手动委派 | 手动委派 |
| **共享系统提示** | 否 | 是 | 是 |
| **可移植性** | 高度可移植（单个 .md 文件） | 不实用 | 不实用 |
| **配置** | YAML frontmatter + 系统提示 | 仅任务描述 | 仅任务描述 |
| **系统提示** | 自定义系统提示访问 | 继承系统提示 | 继承系统提示 |
| **自定义工具选择** | 是 | 否 | 否 |
| **Claude.md 继承** | 是 | 是 | 是 |
| **用例** | 专业化可重复任务 | 多视角分析 | 并行任务执行 |

`自定义代理`提供**自动激活**、**隔离上下文**和**精确工具选择**，消除了之前方法的令牌膨胀和手动编排。

* * *

* * *

## 自定义代理设计[​](#自定义代理设计 "直接链接到自定义代理设计")

我认为设计`自定义代理`时最重要的方面之一是仔细设计您的`自定义代理`需要多少令牌来初始化。优化这一点有多重目的：提高初始化速度、降低成本、保持[峰值性能](/mechanics-context-window-depletion.html)并实现高效链接。

每次`自定义代理`调用都会根据工具数量和配置复杂度产生**可变的初始化成本**。设计决策应考虑这一点：

**按工具数量的性能分析（轶事实验）：**

| 工具数量 | 令牌使用量 | 相对初始化时间 | Claude.md 为空 |
|----------|------------|----------------|----------------|
| 0 | 640 | 2.6s | true |
| 1 | 2.6k | 3.9s | false |
| 2 | 2.9k | 4.3s | false |
| 3 | 3.2k | 6.0s | false |
| 4 | 3.4k | 6.1s | false |
| 5 | 3.9k | 5.1s | false |
| 6 | 4.1k | 7.0s | false |
| 7 | 5.0k | 6.9s | false |
| 8 | 7.1k | 5.6s | false |
| 9 | 7.5k | 5.1s | false |
| 10 | 7.9k | 6.2s | false |
| 15+ | 13.9k - 25k | 6.4s | false |

*注意：0 工具实验是在完全空的 `Claude.md` 下进行的，因此反映了最佳情况。1-15+ 工具的实验是在非空的 `Claude.md` 下进行的。令牌成本和初始化时间受添加的特定工具影响。*

**代理权重分类：**

-   **轻量级代理**：3k 令牌以下 - 低初始化成本
-   **中等权重代理**：10-15k 令牌 - 中等初始化成本
-   **重量级代理**：25k+ 令牌 - 高初始化成本

**订阅和模型优化：** 由于订阅限制，轻量级、高性能的`自定义代理`比重量级`自定义代理`会被更多地使用和实验。它们是最易组合和最易使用的。我们应该努力使我们的`自定义代理`尽可能高性能和可组合。

**模型选择策略：** 随着 v1.0.64 中引入 `model` 参数，您现在可以指定每个代理应该使用哪个模型（sonnet、opus、haiku）。这创造了前所未有的实验机会：

**传统配对（起点）：**

-   **Haiku + 轻量级代理**：频繁、简单的任务 - 成本最低、可组合性最高
-   **Sonnet + 中等代理**：中等复杂度任务的平衡方法
-   **Opus + 重量级代理**：需要最大推理能力的复杂分析

**交叉实验机会（未探索领域）：**

-   **Opus + 轻量级代理**：可能在简单任务中解锁令人惊讶的深度
-   **Haiku + 重量级代理**：可能揭示复杂工作流程的新路径（老虎机）
-   **模型轮换**：同一代理使用不同模型进行 A/B 性能测试

关键洞察是这是**未知领域** - 广泛基准测试并分享发现。传统智慧可能不适用于这些新组合。

**代理可链接性影响：** `自定义代理`的复杂性由于启动时间和令牌使用而显著影响其可链接性。重量级`自定义代理`（25k+ 令牌）在多代理工作流程中造成瓶颈，而轻量级`自定义代理`（3k 令牌以下）实现流畅的编排。作为未来的**代理工程师**，我们必须优化单个`自定义代理`指标及其可组合性：

-   **个体优化**：在保留能力的同时最小化工具数量
-   **组合策略**：平衡专业化高成本`自定义代理`与高效代理（类似于 CPU 设计中的 [big.LITTLE](https://en.wikipedia.org/wiki/ARM_big.LITTLE) 概念）
-   **工作流设计**：链接多个`自定义代理`时考虑累积令牌成本
-   **性能监控**：跟踪不同用例中的`自定义代理`效率指标

* * *

* * *

## 何时使用自定义代理[​](#何时使用自定义代理 "直接链接到何时使用自定义代理")

`自定义代理`在与[分角色子代理](/mechanics-split-role-sub-agents.html)相同的场景中表现出色，但具有增强的可移植性和自动激活：

### 专业领域任务[​](#专业领域任务 "直接链接到专业领域任务")

-   **代码审查** - 安全性、性能、可维护性分析
-   **研究任务** - API 文档、库比较、最佳实践
-   **质量保证** - 测试策略、边缘案例识别
-   **文档编写** - 技术写作、SEO 优化、可访问性
-   **设计分析** - UX 审查、布局评估、设计一致性
-   **内容质量** - 可读性专家、语法专家、品牌语音专家

### 便携式工作流[​](#便携式工作流 "直接链接到便携式工作流")

与绑定到特定项目的`子代理`不同，`自定义代理`可以一次优化并跨多个项目使用，使其理想用于：

-   跨项目标准执行
-   团队工作流标准化
-   个人专业能力放大
-   社区知识共享

* * *

* * *

## 基本功能[​](#基本功能 "直接链接到基本功能")

### 不继承 CLAUDE.md[​](#不继承-claudemd "直接链接到不继承 CLAUDE.md")

**主要优势**：与传统子代理不同，自定义代理设计为不自动继承项目的 `CLAUDE.md` 配置。这可以防止上下文污染并确保跨项目的一致行为。您可以通过[健全性检查](/mechanics-sanity-check.html)来验证这一点。

### 为您的自定义代理着色[​](#为您的自定义代理着色 "直接链接到为您的自定义代理着色")

自定义代理可以通过终端颜色格式在其指示器中进行视觉区分，使得在复杂工作流程中更容易跟踪哪个代理正在响应。这有助于在多个代理活动或查看对话历史时保持清晰。

### 代理昵称以提高效率[​](#代理昵称以提高效率 "直接链接到代理昵称以提高效率")

为常用代理配置简短昵称：

-   **UX 代理 (`A1`)** - 快速 UX 分析
-   **安全代理 (`S1`)** - 快速安全审查
-   **性能代理 (`P1`)** - 性能优化

带昵称的配置示例：

```bash
---

name: UX Agent (A1)

description: UX specialist for user experience analysis. Use this agent when evaluating interfaces and user workflows.

tools: Read, Grep, Glob

---

You are a UX specialist focused on user experience analysis and interface evaluation.

When invoked:

1. Analyze user interface elements and workflows

2. Identify usability issues and improvement opportunities

3. Provide actionable UX recommendations

4. Consider accessibility and user journey optimization

```

**使用昵称调用代理：**

```bash
ask agent a1 to review the navigation menu UX

```

或：

```bash
ask a1 to review the navigation menu UX

```

### 高级昵称工作流[​](#高级昵称工作流 "直接链接到高级昵称工作流")

为`自定义代理`提供昵称的能力有助于改善手动调用，并开启了通过昵称 `A1, P2, C1` 调用`自定义代理`等可能性。

```bash
ask A1, P2, C1 to review the changes

```

### 配置自动委派[​](#配置自动委派 "直接链接到配置自动委派")

`自定义代理`由`委派代理`根据您提示中的任务描述、`自定义代理`配置中的描述字段、当前上下文和可用工具自动使用。

在制作您的`自定义代理`时，您需要评估 Claude 调用您的`自定义代理`的可靠性。如果您需要提高可靠性，请探索更新代理的名称、描述或系统提示。配置您的`自定义代理`以便 Claude 及时使用是一种`工具 SEO`。

Anthropic 提到，为了鼓励主动使用`自定义代理`，我们应该在`自定义代理`的`描述`字段中包含诸如`主动使用`或`必须使用`之类的术语。这与您通过正确格式化 `Claude.md` 来获得 Claude 良好遵守的方式类似。

* * *

* * *

## 设计考虑[​](#设计考虑 "直接链接到设计考虑")

### 入门策略[​](#入门策略 "直接链接到入门策略")

**令牌优先设计：**

-   最初创建专注的、单一用途的代理
-   从轻量级代理（最少或无工具）开始，以获得最大可组合性
-   仔细设计您的自定义代理需要多少令牌来初始化
-   对于频繁使用的代理，优先考虑效率而非能力

**配置最佳实践：**

-   使用清晰、具体的描述以实现可靠的自动激活
-   最初仅授予必要的工具，根据需要扩展
-   **选择适当的模型**：简单代理从 Haiku 开始，根据复杂性需求扩展到 sonnet/opus
-   在扩展之前测试代理可靠性
-   在系统提示中包含示例以获得更好的模式识别
-   在部署到工作流之前隔离测试代理
-   为可链接性和多代理管道设计
-   **将模型与代理权重匹配**：将轻量级代理与 Haiku 配对，重量级代理与 Sonnet 配对以获得最佳成本/性能
-   经常测试代理并与他人分享以帮助验证有效性

### 模型选择策略[​](#模型选择策略 "直接链接到模型选择策略")

`model` 参数在代理工程中开启了未探索的可能性。**这是前沿领域** - 以实验性的好奇心而非僵化的规则来对待。

**基准理解（传统期望）：**

-   **Haiku 代理**：提交消息生成、简单格式化、基本验证、重复性任务
-   **Sonnet 代理**：中等分析、平衡推理任务、通用工作流
-   **Opus 代理**：复杂分析、代码审查、研究、深度推理任务

**实验发现框架：**

-   **挑战假设**：测试"简单"任务是否受益于 opus 智能
-   **逆转期望**：在复杂代理上尝试 Haiku 以找到效率突破
-   **系统基准测试**：测量实际性能与理论预测

**以发现为导向的生命周期：**

1.  **从传统配对开始**：建立基准性能
2.  **交叉实验**：测试非常规模型/代理组合
3.  **测量一切**：令牌使用、令牌成本、速度、质量、用户满意度
4.  **分享突破性发现**：贡献发现以扩展集体知识
5.  **基于真实数据迭代**：让经验结果指导优化，而非假设

**社区协作：** 代理工程社区应该积极分享基准测试结果和令人惊讶的发现。在一个用例中有效的方法可能会彻底改变另一个用例。

* * *

入门指南

从一个简单、专注的自定义代理开始，解决您经常遇到的特定问题。测试其有效性，并根据 Claude 自动调用它的可靠性来优化其描述。

实验方法

虽然效率很重要，但不要让优化假设限制发现。使用 Haiku 的重量级代理可能会以高效的性能让您惊讶，或者使用 opus 的"简单"代理可能会解锁意想不到的能力。

##### 基础优先

在深入复杂链接之前掌握自定义代理的基础知识。对这些基础的扎实理解将实现更有效的链接和更高的使用频率。

<img src="/img/discovery/028_fire.png" alt="Custom image" style="max-width: 165px; height: auto;" />

* * *

**另请参阅**: [自定义代理](/mechanics-custom-agents.html)|[任务代理工具](/mechanics-task-agent-tools.html)

**作者**:[<img src="/img/claudes-greatest-soldier.png" alt="InventorBlack profile" style="width: 25px; height: 25px; display: inline-block; vertical-align: middle; margin: 0 3px; border-radius: 50%;" />InventorBlack](https://www.linkedin.com/in/wilfredkasekende/)|[Command Stick](https://commandstick.com) CTO|[r/ClaudeAi](https://reddit.com/r/ClaudeAI) 版主

-   [理解代理生态系统](#理解代理生态系统)
-   [自定义代理设计](#自定义代理设计)
-   [何时使用自定义代理](#何时使用自定义代理)
    -   [专业领域任务](#专业领域任务)
    -   [便携式工作流](#便携式工作流)
-   [基本功能](#基本功能)
    -   [不继承 CLAUDE.md](#不继承-claudemd)
    -   [为您的自定义代理着色](#为您的自定义代理着色)
    -   [代理昵称以提高效率](#代理昵称以提高效率)
    -   [高级昵称工作流](#高级昵称工作流)
    -   [配置自动委派](#配置自动委派)
-   [设计考虑](#设计考虑)
    -   [入门策略](#入门策略)
    -   [模型选择策略](#模型选择策略)