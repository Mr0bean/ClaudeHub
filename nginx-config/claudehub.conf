# ClaudeHub 中文文档网站 Nginx 配置
# 解决 VuePress base URL 路径问题

server {
    listen 80;
    server_name _;  # 匹配所有域名，可以根据需要修改为具体域名

    root /var/www/claudehub;
    index index.html;

    # 主页重定向到 /ClaudeHub/
    location = / {
        return 301 /ClaudeHub/;
    }

    # 处理静态资源 (assets, img) - 关键修复
    # VuePress 生成的链接格式：/ClaudeHub/assets/xxx.css
    # 需要重写为：/assets/xxx.css 来匹配文件系统
    location ~ ^/ClaudeHub/(assets|img)/ {
        rewrite ^/ClaudeHub/(.*)$ /$1 break;
        try_files $uri =404;

        # 静态资源缓存优化
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # 处理 HTML 页面
    location /ClaudeHub/ {
        rewrite ^/ClaudeHub/(.*)$ /$1 break;
        try_files $uri $uri/ /index.html;
    }

    # 安全头设置
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;

    # 自定义错误页面
    error_page 404 /404.html;
}